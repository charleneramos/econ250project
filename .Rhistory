select(district, transact08)
prob09 <- prob %>%
filter(year == 2009) %>%
rename(transact09 = value) %>%
select(district, transact09)
prob10 <- prob %>%
filter(year == 2010) %>%
rename(transact10 = value) %>%
select(district, transact10)
prob11 <- prob %>%
filter(year == 2011) %>%
rename(transact11 = value) %>%
select(district, transact11)
prob12 <- prob %>%
filter(year == 2012) %>%
rename(transact12 = value) %>%
select(district, transact12)
prob13 <- prob %>%
filter(year == 2013) %>%
rename(transact13 = value) %>%
select(district, transact13)
prob_aid <- reduce(list(df_frame,
prob00, prob01, prob02, prob03, prob04,
prob05, prob06, prob07, prob08, prob09,
prob10, prob11, prob12, prob13),
left_join, by = 'district')
prob_aid <- prob_aid %>%
mutate(count = rowSums(!is.na(select(., -district)))) %>%
mutate(prob = count / 14) %>%
select(district, prob)
rm(prob, prob00, prob01, prob02, prob03, prob04,
prob05, prob06, prob07, prob08, prob09,
prob10, prob11, prob12, prob13)
df <- prob_aid
# ---- filter 2014-2017 years format ----
df_filter2 <- df_filter %>%
filter(transactions_end_year > 2013 & transactions_end_year < 2018) # filter for years 2013-2017
df_frame <- as.data.frame(aiddata_raw$shapeName)
colnames(df_frame) <- 'district'
aid_raw <- df_filter2 %>%
select(place_name, transactions_end_year, total_commitments, transaction_value, total_disbursements, even_split_disbursements) %>%
group_by(place_name, transactions_end_year) %>%
summarise(
total_commitments = sum(total_commitments),
transaction_value = sum(transaction_value),
total_disbursements = sum(total_disbursements),
even_split_disbursements = sum(even_split_disbursements),
) %>%
rename('district' = place_name,
'year' = transactions_end_year)
aid_raw <- aid_raw %>%
mutate(district = tolower(district)) %>%
mutate(district = gsub("district", "", district, ignore.case = TRUE)) %>%
filter(!grepl('council', district, ignore.case = TRUE)) %>%
mutate(district = paste0(toupper(substr(district, 1, 1)),
substr(district, 2, nchar(district))))
aid_raw$district <- aid_raw$district %>% trimws() %>% gsub(" ", "", .)
aid14 <- aid_raw %>%
arrange(district) %>%
filter(year == 2014) %>%
mutate(ltransac14 = log(transaction_value),
lcommit14 = log(total_commitments),
ldisburse14 = log(total_disbursements),
lesplit14 = log(total_disbursements)) %>%
select(district, ltransac14, lcommit14, ldisburse14, lesplit14)
aid15 <- aid_raw %>%
arrange(district) %>%
filter(year == 2015) %>%
mutate(ltransac15 = log(transaction_value),
lcommit15 = log(total_commitments),
ldisburse15 = log(total_disbursements),
lesplit15 = log(total_disbursements)) %>%
select(district, ltransac15, lcommit15, ldisburse15, lesplit15)
aid16 <- aid_raw %>%
arrange(district) %>%
filter(year == 2016) %>%
mutate(ltransac16 = log(transaction_value),
lcommit16 = log(total_commitments),
ldisburse16 = log(total_disbursements),
lesplit16 = log(total_disbursements)) %>%
select(district, ltransac16, lcommit16, ldisburse16, lesplit16)
aid17 <- aid_raw %>%
arrange(district) %>%
filter(year == 2017) %>%
mutate(ltransac17 = log(transaction_value),
lcommit17 = log(total_commitments),
ldisburse17 = log(total_disbursements),
lesplit17 = log(total_disbursements)) %>%
select(district, ltransac17, lcommit17, ldisburse17, lesplit17)
aid  <- reduce(list(df_frame, aid14, aid15, aid16, aid17), left_join, by = 'district')
aid <- aid %>%
select(district,ltransac14,ltransac15,ltransac16,ltransac17,
lcommit14,lcommit15,lcommit16,lcommit17,
ldisburse14,ldisburse15,ldisburse16,ldisburse17,
lesplit14,lesplit15,lesplit16,lesplit17)
df <- right_join(df, aid, by = 'district')
rm(aid_raw, aid14, aid15, aid16, aid17)
# light density growth
ntl <- aiddata_raw %>%
select(shapeName, viirs_ntl_annual_v21_cf_cvg.2014.sum, viirs_ntl_annual_v21_cf_cvg.2014.count,
viirs_ntl_annual_v21_cf_cvg.2015.sum, viirs_ntl_annual_v21_cf_cvg.2015.count,
viirs_ntl_annual_v21_cf_cvg.2016.sum, viirs_ntl_annual_v21_cf_cvg.2016.count,
viirs_ntl_annual_v21_cf_cvg.2017.sum, viirs_ntl_annual_v21_cf_cvg.2017.count,
viirs_ntl_annual_v21_avg_masked.2014.mean,
viirs_ntl_annual_v21_avg_masked.2015.mean,
viirs_ntl_annual_v21_avg_masked.2016.mean,
viirs_ntl_annual_v21_avg_masked.2017.mean) %>%
rename('ntl_cf14_sum' = viirs_ntl_annual_v21_cf_cvg.2014.sum, 'ntl_cf14_count' = viirs_ntl_annual_v21_cf_cvg.2014.count,
'ntl_cf15_sum' = viirs_ntl_annual_v21_cf_cvg.2015.sum, 'ntl_cf15_count' = viirs_ntl_annual_v21_cf_cvg.2015.count,
'ntl_cf16_sum' = viirs_ntl_annual_v21_cf_cvg.2016.sum, 'ntl_cf16_count' = viirs_ntl_annual_v21_cf_cvg.2016.count,
'ntl_cf17_sum' = viirs_ntl_annual_v21_cf_cvg.2017.sum, 'ntl_cf17_count' = viirs_ntl_annual_v21_cf_cvg.2017.count,
'ntl14' = viirs_ntl_annual_v21_avg_masked.2014.mean,
'ntl15' = viirs_ntl_annual_v21_avg_masked.2015.mean,
'ntl16' = viirs_ntl_annual_v21_avg_masked.2016.mean,
'ntl17' = viirs_ntl_annual_v21_avg_masked.2017.mean)
ntl14 <- ntl %>%
select(shapeName, ntl_cf14_sum, ntl_cf14_count, ntl14) %>%
mutate(ratio = ntl_cf14_sum/ntl_cf14_count) %>%
mutate(cf14 = if_else(ratio >= 0.5, 1, 0)) %>%
select(shapeName, cf14, ntl14)
ntl15 <- ntl %>%
select(shapeName, ntl_cf15_sum, ntl_cf15_count, ntl15) %>%
mutate(ratio = ntl_cf15_sum/ntl_cf15_count) %>%
mutate(cf15 = if_else(ratio >= 0.5, 1, 0)) %>%
select(shapeName, cf15, ntl15)
ntl16 <- ntl %>%
select(shapeName, ntl_cf16_sum, ntl_cf16_count, ntl16) %>%
mutate(ratio = ntl_cf16_sum/ntl_cf16_count) %>%
mutate(cf16 = if_else(ratio >= 0.5, 1, 0)) %>%
select(shapeName, cf16, ntl16)
ntl17 <- ntl %>%
select(shapeName, ntl_cf17_sum, ntl_cf17_count, ntl17) %>%
mutate(ratio = ntl_cf17_sum/ntl_cf17_count) %>%
mutate(cf17 = if_else(ratio >= 0.5, 1, 0)) %>%
select(shapeName, cf17, ntl17)
ntl <- reduce(list(ntl14, ntl15, ntl16, ntl17), left_join, by = 'shapeName')
ntl <- ntl %>%
select(shapeName, ntl14, ntl15, ntl16, ntl17) %>%
rename('district' = shapeName)
rm(ntl14, ntl15, ntl16, ntl17)
# population density
pop14 <- aiddata_raw %>%
select(shapeName, worldpop_pop_count_1km_mosaic.2014.sum) %>%
rename('pop14' = worldpop_pop_count_1km_mosaic.2014.sum) %>%
mutate(lpop14 = log(pop14))
pop15 <- aiddata_raw %>%
select(shapeName, worldpop_pop_count_1km_mosaic.2015.sum) %>%
rename('pop15' = worldpop_pop_count_1km_mosaic.2015.sum) %>%
mutate(lpop15 = log(pop15))
pop16 <- aiddata_raw %>%
select(shapeName, worldpop_pop_count_1km_mosaic.2016.sum) %>%
rename('pop16' = worldpop_pop_count_1km_mosaic.2016.sum) %>%
mutate(lpop16 = log(pop16))
pop17 <- aiddata_raw %>%
select(shapeName, worldpop_pop_count_1km_mosaic.2017.sum) %>%
rename('pop17' = worldpop_pop_count_1km_mosaic.2017.sum) %>%
mutate(lpop17 = log(pop17))
pop <- reduce(list(pop14, pop15, pop16, pop17), left_join, by = 'shapeName')
pop <- pop %>%
select(shapeName, lpop14, lpop15, lpop16, lpop17) %>%
rename('district' = shapeName)
rm(pop14, pop15, pop16, pop17)
# rainfall
rain14 <- aiddata_raw %>%
select(shapeName, udel_precip_v501_sum.2014.sum) %>%
rename('rain14' = udel_precip_v501_sum.2014.sum) %>%
mutate(lrain14 = log(rain14))
rain15 <- aiddata_raw %>%
select(shapeName, udel_precip_v501_sum.2015.sum) %>%
rename('rain15' = udel_precip_v501_sum.2015.sum) %>%
mutate(lrain15 = log(rain15))
rain16 <- aiddata_raw %>%
select(shapeName, udel_precip_v501_sum.2016.sum) %>%
rename('rain16' = udel_precip_v501_sum.2016.sum) %>%
mutate(lrain16 = log(rain16))
rain17 <- aiddata_raw %>%
select(shapeName, udel_precip_v501_sum.2017.sum) %>%
rename('rain17' = udel_precip_v501_sum.2017.sum) %>%
mutate(lrain17 = log(rain17))
rain <- reduce(list(rain14, rain15, rain16, rain17), left_join, by = 'shapeName')
rain <- rain %>%
select(shapeName, lrain14, lrain15, lrain16, lrain17) %>%
rename('district' = shapeName)
rm(rain14, rain15, rain16, rain17)
# public expenditure, education
spend14 <- spend14_raw %>%
filter(Program %in% c('SCHOOL CONSTRUCTION PROGRAMME','Education','SECONDARY SCHOOL CONSTRUCTION')) %>%
group_by(Vote) %>%
summarise(value = sum(`Approved Budget` , na.rm = TRUE)) %>%
mutate(lspend14 = log(value)) %>%
select(Vote, lspend14) %>%
rename('district' = Vote)
spend15 <- spend15_raw %>%
filter(Program %in% c('SCHOOL CONSTRUCTION PROGRAMME','Education','SECONDARY SCHOOL CONSTRUCTION')) %>%
group_by(Vote) %>%
summarise(value = sum(`Approved Budget` , na.rm = TRUE)) %>%
mutate(lspend15 = log(value)) %>%
select(Vote, lspend15) %>%
rename('district' = Vote)
spend16 <- spend16_raw %>%
filter(Program %in% c('Education Development','Education')) %>%
group_by(Vote) %>%
summarise(value = sum(`Approved Budget` , na.rm = TRUE)) %>%
mutate(lspend16 = log(value)) %>%
select(Vote, lspend16) %>%
rename('district' = Vote)
spend17 <- spend17_raw %>%
filter(Program %in% c('Education','Education Development')) %>%
group_by(Vote) %>%
summarise(value = sum(`Amount` , na.rm = TRUE)) %>%
mutate(lspend17 = log(value)) %>%
select(Vote, lspend17) %>%
rename('district' = Vote)
spend <- reduce(list(spend14, spend15, spend16), left_join, by = 'district')
spend <- spend %>%
mutate(district = tolower(district)) %>%
mutate(district = gsub("district", "", district, ignore.case = TRUE)) %>%
filter(!grepl('council', district, ignore.case = TRUE)) %>%
mutate(district = paste0(toupper(substr(district, 1, 1)),
substr(district, 2, nchar(district))))
spend17 <- spend17 %>%
mutate(district = tolower(district)) %>%
mutate(district = gsub("district", "", district, ignore.case = TRUE)) %>%
filter(!grepl('council', district, ignore.case = TRUE)) %>%
mutate(district = paste0(toupper(substr(district, 1, 1)),
substr(district, 2, nchar(district))))
spend <- right_join(spend, spend17, by = 'district')
spend <- spend %>%
arrange(district)
spend$district <- spend$district %>% trimws() %>% gsub(" ", "", .)
rm(spend14_raw, spend15_raw, spend16_raw, spend17_raw, spend14, spend15, spend16, spend17)
# ---- merge controls ----
ctrls <- reduce(list(ntl, pop, rain, spend), left_join, by = 'district')
df <- left_join(df, ctrls, by = 'district')
rm(aiddata_raw, ntl, pop, rain, spend)
write.csv(df, here('data', 'final', 'df.csv'), row.names = FALSE)
# ---- filter unique transactions ----
df_transact <- df_filter2 %>%
arrange(transactions_end_year) %>%
distinct(transaction_id, .keep_all = TRUE)
# ---- identify top donors ----
top_donors <- df_transact %>%
group_by(donors) %>%
summarise(
transact_sum = sum(transaction_value, na.rm = TRUE),
transact_n = n(),
.groups = "drop"
) %>%
arrange(desc(transact_sum)) %>%
mutate(
percent_transact_sum = transact_sum / sum(df_transact$transaction_value, na.rm = TRUE) * 100
) %>%
select(donors, transact_sum, transact_n, percent_transact_sum)
total_row <- top_donors %>%
summarise(
donors = "Total",
transact_sum = sum(transact_sum, na.rm = TRUE),
transact_n = sum(transact_n, na.rm = TRUE),
percent_transact_sum = sum(percent_transact_sum)
)
top_donors <- bind_rows(top_donors, total_row)
top_donors <- top_donors %>%
mutate(
transact_sum_f = format(round(transact_sum), big.mark = ",", scientific = FALSE),
transact_n_f = format(transact_n, big.mark = ",", scientific = FALSE),
percent_transact_sum_f = paste0(format(round(percent_transact_sum, 1), nsmall = 1, scientific = FALSE), "%")
) %>%
select(donors, transact_n_f, transact_sum_f, percent_transact_sum_f) %>%
rename(Donor = donors,donors = donors,
`# Transactions` = transact_n_f,
`Total (USD)` = transact_sum_f,
`Share (%)` = percent_transact_sum_f
)
rm(total_row)
# ---- dataset for instrumental variable analysis ----
donor_spend_gdp <- WDI(
country = c('EU','US','NO','GB','JP'), # European Union, USA, China, Norway, UK, Japan
indicator = 'NE.CON.GOVT.ZS', # General government final consumption expenditure (% of GDP)
start = 2014, end   = 2017
)
donor_spend_gdp <- donor_spend_gdp %>%
rename('donors' = country,
'year' = year,
'spend_gdp' = NE.CON.GOVT.ZS) %>%
select(donors, year, spend_gdp) %>%
mutate(donors = if_else(donors == "United States",
"United States of America",
donors)) %>%
arrange(donors, year)
donor_spend_gdp$donors <- donor_spend_gdp$donors %>% trimws()
df_iv <- df_filter2 %>%
group_by(place_name, transactions_end_year, donors) %>%
mutate(transact = sum(transaction_value),
commit = sum(total_commitments),
disburse = sum(total_disbursements),
esplit = sum(even_split_disbursements)) %>%
select(place_name, transactions_end_year, donors, transact, commit, disburse, esplit) %>%
distinct() %>%
rename('district' = place_name,
'year' = transactions_end_year) %>%
ungroup()
df_iv <- df_iv %>%
mutate(district = tolower(district)) %>%
mutate(district = gsub("district", "", district, ignore.case = TRUE)) %>%
filter(!grepl('council', district, ignore.case = TRUE)) %>%
mutate(district = paste0(toupper(substr(district, 1, 1)),
substr(district, 2, nchar(district))))
df_iv <- df_iv %>%
mutate(ltransact = log(transact),
lcommit = log(commit),
ldisburse = log(disburse),
lesplit = log(esplit)) %>%
select(district, year, donors, ltransact, lcommit, ldisburse, lesplit) %>%
arrange(donors) %>%
filter(!donors %in% c('International Development Association','United Nations Development Programme','International Development Association|China'))
df_iv$district <- df_iv$district %>% trimws() %>% gsub(" ", "", .)
df_iv$donors <- df_iv$donors %>% trimws()
df_iv <- left_join(df_iv, donor_spend_gdp, by = c('donors','year'))
df_iv <- df_iv %>%
select(district, year, donors, spend_gdp, everything())  %>%
arrange(district, year)
df_iv <- left_join(df_iv, prob_aid, by = 'district')
df_iv <- df_iv %>%
select(district, prob, year, donors, spend_gdp, everything()) %>%
arrange(donors, year, district)
write.csv(df_iv, here('data', 'final', 'df_iv.csv'), row.names = FALSE)
# ---- filter education-specific aid ----
df_edu <- df_filter2 %>%
filter(ad_sector_names %in% c('Education','Agriculture|Education'))
df_edu <- df_edu %>%
mutate(transac17 = log(transaction_value),
lcommit17 = log(total_commitments),
ldisburse17 = log(total_disbursements),
lesplit17 = log(total_disbursements))
write_csv(df_edu, here("data", "final", "aid_edu.csv"))
# ---- create summary statistics, education ----
edu_transact <- df_edu %>%
group_by(transactions_end_year) %>%
summarise(
mean = mean(transaction_value),
sd = sd(transaction_value),
n = n(),
min = min(transaction_value),
max = max(transaction_value)
) %>%
mutate(region = 'All', variable = 'transaction') %>%
rename(year = transactions_end_year) %>%
select(c('variable','region'), everything())
edu_disburse <- df_edu %>%
group_by(transactions_end_year) %>%
summarise(
mean = mean(total_disbursements),
sd = sd(total_disbursements),
n = n(),
min = min(total_disbursements),
max = max(total_disbursements)
) %>%
mutate(region = 'All', variable = 'total_disbursement') %>%
rename(year = transactions_end_year) %>%
select(c('variable','region'), everything())
edu_esplit <- df_edu %>%
group_by(transactions_end_year) %>%
summarise(
mean = mean(even_split_disbursements),
sd = sd(even_split_disbursements),
n = n(),
min = min(even_split_disbursements),
max = max(even_split_disbursements)
) %>%
mutate(region = 'All', variable = 'even_split_disbursement') %>%
rename(year = transactions_end_year) %>%
select(c('variable','region'), everything())
edu_stats <- bind_rows(edu_transact, edu_disburse, edu_esplit)
rm(edu_disburse, edu_esplit, edu_transact)
write_csv(edu_stats, here("data", "final", "edu_stats.csv"))
# ---- create summary statistics, aggregate ----
all_transact <- df_transact %>%
group_by(transactions_end_year) %>%
summarise(
mean = mean(transaction_value),
sd = sd(transaction_value),
n = n(),
min = min(transaction_value),
max = max(transaction_value)
) %>%
mutate(region = 'All', variable = 'transaction') %>%
rename(year = transactions_end_year) %>%
select(c('variable','region'), everything())
all_disburse <- df_transact %>%
group_by(transactions_end_year) %>%
summarise(
mean = mean(total_disbursements),
sd = sd(total_disbursements),
n = n(),
min = min(total_disbursements),
max = max(total_disbursements)
) %>%
mutate(region = 'All', variable = 'total_disbursement') %>%
rename(year = transactions_end_year) %>%
select(c('variable','region'), everything())
all_esplit <- df_transact %>%
group_by(transactions_end_year) %>%
summarise(
mean = mean(even_split_disbursements),
sd = sd(even_split_disbursements),
n = n(),
min = min(even_split_disbursements),
max = max(even_split_disbursements)
) %>%
mutate(region = 'All', variable = 'even_split_disbursement') %>%
rename(year = transactions_end_year) %>%
select(c('variable','region'), everything())
df_stats <- bind_rows(all_transact, all_disburse, all_esplit)
rm(all_disburse, all_esplit, all_transact)
write_csv(df_stats, here("data", "final", "aid_stats.csv"))
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
View(df_stats)
View(df_stats)
View(df_stats)
View(edu_stats)
View(edu_stats)
View(edu_stats)
View(edu_stats)
round(edu_stats$mean[edu_stat$variable == transaction & edu_stats$year == 2014])
round(edu_stats$mean[edu_stats$variable == transaction & edu_stats$year == 2014])
(round(edu_stats$mean[edu_stats$variable == 'transaction' & edu_stats$year == 2014])
)
edu_stats$mean[edu_stats$variable == 'transaction' & edu_stats$year == 2014]
edu_stats$mean
edu_stats$variable
View(edu_stats)
View(df_stats)
edu_stats$variable == 'transaction' & edu_stats$year == 2015]
edu_stats$mean[edu_stats$variable == 'transaction' & edu_stats$year ==2015]
View(edu_stats)
View(edu_stats)
View(edu_stats)
View(edu_stats)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
rmarkdown::render(
"/Users/charleneramos/Documents/Git/econ250project/code/vsp_draft.Rmd",
output_format = "pdf_document",
output_dir = "/Users/charleneramos/Documents/Git/econ250project/output/"
)
